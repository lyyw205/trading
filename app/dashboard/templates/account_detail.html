{% extends "base.html" %}

{% block title %}Account Dashboard - Crypto Multi-Trader{% endblock %}

{% block content %}
<div class="page-header">
  <a href="/accounts" class="back-link">&larr; All Accounts</a>
  <div class="account-header" id="account-header">
    <h1 class="page-title" id="account-label">Loading...</h1>
    <span class="status-badge" id="account-status-badge"></span>
  </div>
</div>

<!-- Section 1: Price Chart -->
<section class="dashboard-section">
  <div class="section-header">
    <h2 class="section-title">Price Chart</h2>
    <span class="section-subtitle" id="chart-symbol"></span>
  </div>
  <div id="price-chart" class="chart-container"></div>
</section>

<!-- Section 2: Asset Status -->
<section class="dashboard-section">
  <div class="section-header">
    <h2 class="section-title">Asset Status</h2>
  </div>
  <div id="asset-status" class="asset-grid">
    <div class="loading-spinner">Loading...</div>
  </div>
</section>

<!-- Section 3: LOT Table -->
<section class="dashboard-section">
  <div class="section-header">
    <h2 class="section-title">Open Lots</h2>
    <div class="filter-tabs" id="lot-filter-tabs">
      <button class="filter-tab active" data-filter="all" onclick="filterLots('all')">All</button>
    </div>
  </div>
  <div class="table-wrapper">
    <table class="data-table" id="lots-table">
      <thead>
        <tr>
          <th>#</th>
          <th>Strategy</th>
          <th>Buy Price</th>
          <th>Qty</th>
          <th>Cost</th>
          <th>Current Price</th>
          <th>P&amp;L%</th>
          <th>Sell Order Status</th>
        </tr>
      </thead>
      <tbody id="lots-tbody">
        <tr><td colspan="8" class="table-empty">Loading...</td></tr>
      </tbody>
    </table>
  </div>
</section>

<!-- Section 4: Trading Combos -->
<section class="dashboard-section">
  <div class="section-header">
    <h2 class="section-title">Trading Combos</h2>
    <button class="btn btn-primary btn-sm" onclick="showCreateComboModal()">+ New Combo</button>
  </div>
  <div id="combos-panel">
    <div class="loading-spinner">Loading...</div>
  </div>
</section>

<!-- Combo Create/Edit Modal -->
<div id="combo-modal" class="modal-overlay" style="display:none;">
  <div class="modal-content">
    <h3 id="combo-modal-title">New Combo</h3>
    <input type="hidden" id="combo-edit-id">
    <div class="form-group">
      <label class="form-label">Name</label>
      <input type="text" id="combo-name" class="form-input" placeholder="e.g. BTC LOT + Fixed TP">
    </div>
    <div class="form-group" id="combo-buy-logic-group">
      <label class="form-label">Buy Logic</label>
      <select id="combo-buy-logic" class="form-input" onchange="renderComboParams('buy')"></select>
    </div>
    <div id="combo-buy-params"></div>
    <div class="form-group" id="combo-sell-logic-group">
      <label class="form-label">Sell Logic</label>
      <select id="combo-sell-logic" class="form-input" onchange="renderComboParams('sell')"></select>
    </div>
    <div id="combo-sell-params"></div>
    <div class="form-group">
      <label class="form-label">Reference Combo (optional)</label>
      <select id="combo-reference" class="form-input">
        <option value="">None</option>
      </select>
    </div>
    <div style="display:flex;gap:0.5rem;margin-top:1rem;">
      <button class="btn btn-primary" onclick="saveCombo()">Save</button>
      <button class="btn btn-outline" onclick="closeComboModal()">Cancel</button>
    </div>
  </div>
</div>

<!-- Section 5: Circuit Breaker -->
<section class="dashboard-section">
  <div class="section-header">
    <h2 class="section-title">Circuit Breaker</h2>
  </div>
  <div id="circuit-breaker-panel" class="cb-panel">
    <div class="loading-spinner">Loading...</div>
  </div>
</section>
{% endblock %}

{% block scripts %}
<script src="https://unpkg.com/lightweight-charts@4/dist/lightweight-charts.standalone.production.js"></script>
<script>
const ACCOUNT_ID = '{{ account_id }}';

document.addEventListener('DOMContentLoaded', () => {
  loadAccountDashboard(ACCOUNT_ID);
});
</script>
{% endblock %}
